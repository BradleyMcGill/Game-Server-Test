<!DOCTYPE html>
<html lang="en">
<head>
    <!-- META SECTION -->
    <title>Game stat viewer</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <!-- END META SECTION -->
    <!-- CSS INCLUDE -->
    <link rel="stylesheet" type="text/css" id="theme" href="css/theme-default.css" />
    <link rel="stylesheet" type="text/css" id="theme" href="//cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" />
    <!-- EOF CSS INCLUDE -->
</head>
<body>
    <!-- START PAGE CONTAINER -->
    <div class="page-container">

        <!-- START PAGE SIDEBAR -->
        <div class="page-sidebar">
            <!-- START X-NAVIGATION -->
            <ul class="x-navigation">
                <li class="xn-logo">
                    <a href="index.html">Stats Dashboard</a>
                    <a href="#" class="x-navigation-control"></a>
                </li>
                <li class="xn-profile">
                    <a href="#" class="profile-mini">
                        <img src="assets/images/users/avatar.jpg" alt="John Doe" />
                    </a>
                    <div class="profile">
                        <div class="profile-image">
                            <img src="assets/images/users/avatar.jpg" alt="John Doe" />
                        </div>
                        <div class="profile-data">
                            <div id="user-name" class="profile-data-name"></div>
                            <div id="rank" class="profile-data-title"></div>
                        </div>
                    </div>
                </li>
                <li class="xn-title">Navigation</li>
                <li class="active">
                    <a href="index.html"><span class="fa fa-desktop"></span> <span class="xn-text">Dashboard</span></a>
                </li>
                <!-- END X-NAVIGATION -->
        </div>
        <!-- END PAGE SIDEBAR -->
        <!-- PAGE CONTENT -->
        <div class="page-content">

            <!-- START X-NAVIGATION VERTICAL -->
            <ul class="x-navigation x-navigation-horizontal x-navigation-panel">
                <!-- TOGGLE NAVIGATION -->
                <li class="xn-icon-button">
                    <a href="#" class="x-navigation-minimize"><span class="fa fa-dedent"></span></a>
                </li>
                <!-- END TOGGLE NAVIGATION -->
                <!-- SEARCH -->
                <li class="xn-search">
                    <form role="form">
                        <input type="text" name="search" placeholder="Enter username..."/>
                    </form>
                </li>
                <!-- END SEARCH -->
                
            </ul>
            <!-- END X-NAVIGATION VERTICAL -->
            <!-- START BREADCRUMB -->
            <ul class="breadcrumb">
            </ul>
            <!-- END BREADCRUMB -->
            <!-- PAGE CONTENT WRAPPER -->
            <div class="page-content-wrap">

                <!-- START WIDGETS -->
                <div class="row">
                    <div class="col-md-3">

                        <!-- START WIDGET CLOCK -->
                        <div class="widget widget-info widget-padding-sm">
                            <div class="widget-big-int plugin-clock">00:00</div>
                            <div class="widget-subtitle plugin-date">Loading...</div>
                        </div>
                        <!-- END WIDGET CLOCK -->

                    </div>
                    <div class="col-md-3">

                        <!-- START WIDGET SLIDER -->
                        <div class="widget widget-default widget-carousel">
                            <div class="owl-carousel" id="owl-example">
                                <div>
                                    <div class="widget-title">Total quizes</div>
                                    <div class="widget-subtitle"></div>
                                    <div id="numberOfQuizes" class="widget-int"></div>
                                </div>
                                <div>
                                    <div class="widget-title">Average score</div>
                                    <div class="widget-subtitle"></div>
                                    <div id="averageScore" class="widget-int"></div>
                                </div>
                                <div>
                                    <div class="widget-title">Highscore</div>
                                    <div class="widget-subtitle"></div>
                                    <div id="highscore" class="widget-int"></div>
                                </div>
                            </div>
                        </div>
                        <!-- END WIDGET SLIDER -->

                    </div>
                    <div class="col-md-3">

                        <!-- START WIDGET MESSAGES -->
                        <div class="widget widget-default widget-item-icon" onclick="location.href='pages-messages.html';">
                            <div class="widget-item-left">
                                <span class="fa fa-envelope"></span>
                            </div>
                            <div class="widget-data">
                                <div class="widget-int num-count">Empty Display</div>
                                <div class="widget-title">Empty Display</div>
                                <div class="widget-subtitle">Empty Display</div>
                            </div>
                        </div>
                        <!-- END WIDGET MESSAGES -->

                    </div>
                    <div class="col-md-3">

                        <!-- START WIDGET REGISTRED -->
                        <div class="widget widget-default widget-item-icon" onclick="location.href='pages-address-book.html';">
                            <div class="widget-item-left">
                                <span class="fa fa-user"></span>
                            </div>
                            <div class="widget-data">
                                <div class="widget-int num-count">Empty Display</div>
                                <div class="widget-title">Empty Display</div>
                                <div class="widget-subtitle">Empty Display</div>
                            </div>
                        </div>
                        <!-- END WIDGET REGISTRED -->

                    </div>

                </div>
                <!-- END WIDGETS -->

                <div class="row">
                    <div class="col-md-4">

                        <!-- START USERS ACTIVITY BLOCK -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>Past games</h3>
                                </div>
                                <ul class="panel-controls" style="margin-top: 2px;">
                                    <li><a href="#" class="panel-fullscreen"><span class="fa fa-expand"></span></a></li>
                                    <li><a href="#" class="panel-refresh"><span class="fa fa-refresh"></span></a></li>
                                </ul>
                            </div>
                            <div class="panel-body padding-0">
                                <div class="chart-holder" id="dashboard-bar-1" style="height: 200px;"></div>
                            </div>
                        </div>
                        <!-- END USERS ACTIVITY BLOCK -->

                    </div>
                    <div class="col-md-4">

                        <!-- START VISITORS BLOCK -->
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>Visitors</h3>
                                    <span>Visitors (last month)</span>
                                </div>
                                <ul class="panel-controls" style="margin-top: 2px;">
                                    <li><a href="#" class="panel-fullscreen"><span class="fa fa-expand"></span></a></li>
                                    <li><a href="#" class="panel-refresh"><span class="fa fa-refresh"></span></a></li>
                                </ul>
                            </div>
                            <div class="panel-body padding-0">
                                <div class="chart-holder" id="dashboard-donut-1" style="height: 200px;"></div>
                            </div>
                        </div>
                        <!-- END VISITORS BLOCK -->

                    </div>
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>Sales & Event</h3>
                                    <span>Event "Purchase Button"</span>
                                </div>
                                <ul class="panel-controls" style="margin-top: 2px;">
                                    <li><a href="#" class="panel-fullscreen"><span class="fa fa-expand"></span></a></li>
                                    <li><a href="#" class="panel-refresh"><span class="fa fa-refresh"></span></a></li>
                                </ul>
                            </div>
                            <div class="panel-body padding-0">
                                <div class="chart-holder" id="dashboard-line-1" style="height: 200px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="panel-title-box">
                                    <h3>Scores</h3>
                                </div>
                                <ul class="panel-controls" style="margin-top: 2px;">
                                    <li><a href="#" class="panel-fullscreen"><span class="fa fa-expand"></span></a></li>
                                    <li><a href="#" class="panel-refresh"><span class="fa fa-refresh"></span></a></li>
                                </ul>
                            </div>
                            <div class="panel-body panel-body-table">

                                <div class="table-responsive">
                                    <table id="moo" class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th width="20%">Quiz</th>
                                                <th width="50%">Score</th>
                                                <th width="30%">Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="quiz-results">
                                            <!--HERE-->
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!-- END PAGE CONTENT WRAPPER -->
        </div>
        <!-- END PAGE CONTENT -->
    </div>
    <!-- END PAGE CONTAINER -->
    <!-- MESSAGE BOX-->
    <div class="message-box animated fadeIn" data-sound="alert" id="mb-signout">
        <div class="mb-container">
            <div class="mb-middle">
                <div class="mb-title"><span class="fa fa-sign-out"></span> Log <strong>Out</strong> ?</div>
                <div class="mb-content">
                    <p>Are you sure you want to log out?</p>
                    <p>Press No if you want to continue work. Press Yes to logout current user.</p>
                </div>
                <div class="mb-footer">
                    <div class="pull-right">
                        <a href="pages-login.html" class="btn btn-success btn-lg">Yes</a>
                        <button class="btn btn-default btn-lg mb-control-close">No</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END MESSAGE BOX-->
    <!-- START SCRIPTS -->
    <!-- START PLUGINS -->
    <script type="text/javascript" src="js/plugins/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="js/plugins/jquery/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/plugins/bootstrap/bootstrap.min.js"></script>
    <!-- END PLUGINS -->
    <!-- START THIS PAGE PLUGINS-->
    <script type='text/javascript' src='js/plugins/icheck/icheck.min.js'></script>
    <script type="text/javascript" src="js/plugins/mcustomscrollbar/jquery.mCustomScrollbar.min.js"></script>
    <script type="text/javascript" src="js/plugins/scrolltotop/scrolltopcontrol.js"></script>

    <script type="text/javascript" src="js/plugins/morris/raphael-min.js"></script>
    <script type="text/javascript" src="js/plugins/morris/morris.min.js"></script>
    <script type="text/javascript" src="js/plugins/rickshaw/d3.v3.js"></script>
    <script type="text/javascript" src="js/plugins/rickshaw/rickshaw.min.js"></script>
    <script type='text/javascript' src='js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js'></script>
    <script type='text/javascript' src='js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js'></script>
    <script type='text/javascript' src='js/plugins/bootstrap/bootstrap-datepicker.js'></script>
    <script type="text/javascript" src="js/plugins/owl/owl.carousel.min.js"></script>

    <script type="text/javascript" src="js/plugins/moment.min.js"></script>
    <script type="text/javascript" src="js/plugins/daterangepicker/daterangepicker.js"></script>
    <!-- END THIS PAGE PLUGINS-->
    <!-- START TEMPLATE -->
    <!--<script type="text/javascript" src="js/settings.js"></script>-->

    <script type="text/javascript" src="js/plugins.js"></script>
    <script type="text/javascript" src="js/actions.js"></script>
    <script type="text/javascript" src="//cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript" src="js/demo_dashboard.js"></script>
    <!-- END TEMPLATE -->
    <!-- END SCRIPTS -->


    <script type="text/javascript">
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

        function calculateAverageScore(scores) {
            var running = 0
            for (i = 0; i < scores.length; i++) {
                running += scores[i].score
            }
            return Math.ceil(running / scores.length)
        };

        function getHighestScore(data) {
            var scores = [];
            for (var i = 0; i < data.length; i++) {
                scores.push({
                    date: new Date(data[i].date),
                    score: data[i].score
                });
            }
            scores.sort((a, b) => (a.score < b.score) ? 1 : -1)

            return scores[0].score
        };

        function setUpPage(playerData) {
            name = playerData.name
            scores = playerData.scores
            rank = playerData.rank

            var averageScore = calculateAverageScore(scores)
            var highscore = getHighestScore(scores)

            $("#user-name").html(playerData.name);
            $("#numberOfQuizes").html(scores.length);
            $("#averageScore").html(averageScore);
            $("#highscore").html(highscore);
            $("#rank").html(rank);

            createGraph(playerData.scores);
            createDonut(playerData.scores);
            buildTable(scores);

        }

        function buildTable(data) {

            var trHTML = '';
            $.each(data, function (i, item) {
                trHTML += '<tr><td>' + item.topic + '</td><td>' + item.score + '</td><td>' + item.date + '</td></tr>';
            });
            $('#quiz-results').append(trHTML);
            $('#moo').dataTable({
                "pageLength": 5
            });

        }

        function createGraph(scores) {
            var wibble = [];

            for (var i = 0; i < scores.length; i++) {
                wibble.push({
                    x: moment(new Date(scores[i].date)).format('MMM DD YYYY h:mm'),
                    y: scores[i].score
                });
            }

            Morris.Bar({
                element: 'dashboard-bar-1',
                data: wibble,
                xkey: 'x',
                ykeys: ['y'],
                labels: ['Score'],
                barColors: ['#33414E'],
                gridTextSize: '10px',
                hideHover: true,
                resize: true,
                gridLineColor: '#E5E5E5'
            });
        }

        function iterateThroughElements(list, lookFor) {
            for (var i = 0; i < list.length; i++) {
                if (list[i] == lookFor) {
                    return true
                }
            }
            return false
        }

        function createDonut(scores) {

            var wibble = [];
            var done = [];


            for (var i = 0; i < scores.length; i++) {
                if (iterateThroughElements(done, scores[i].topic) == false) {
                    wibble.push({
                        label: scores[i].topic,
                        value: 1
                    })
                    done.push(scores[i].topic)
                } else {
                    for (var u = 0; u, wibble.length; u++) {
                        if (wibble[u].label == scores[i].topic) {
                            wibble[u].value += 1;
                            break;
                        }
                    }
                }
            };

            console.log(wibble);

            Morris.Donut({
                element: 'dashboard-donut-1',
                data: wibble,
                colors: ['#33414E', '#1caf9a', '#FEA223'],
                resize: true
            });
        }

        $(document).ready(function () {

            var username = getUrlParameter('search');
            var password = getUrlParameter('password');

            $.getJSON('Users\\'+username + ".json", setUpPage);
        });
    </script>
</body>
</html>






